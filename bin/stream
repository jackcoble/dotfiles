#!/bin/bash
# A simple script to stream from my Minio instance into MPV

# Set the Minio instance (same as mc cli)
MC=/usr/bin/mc
HOST=minpi
BUCKET=tv-shows

# Setting the instance
INSTANCE=$HOST/$BUCKET

# Find a TV show using fzf
EPISODE=$($MC ls --recursive $INSTANCE | awk '{$1=""; $2=""; $3=""; $4=""; print}' | sed -e 's/^[ \t]*//' | fzf)

# Now I need to share the file now that we've got the path for it
URL=$($MC share download "$INSTANCE/$EPISODE" | grep -E "Share:" | sed 's/Share: //g')

notify-send "Stream" "Streaming $EPISODE!"

# Lastly, launch MPV!
/usr/bin/mpv --fs "$URL"
