#!/bin/bash
# A simple script to stream from my Minio instance into MPV

# Set the Minio instance (same as mc cli)
HOST=minpi
BUCKET=tv-shows

# Setting the instance
INSTANCE=$HOST/$BUCKET

# Find a TV show based on the name and episode number
# e.g. mc find minpi/tv-shows --name "Billions*S04E11*"
EPISODE=$(/usr/bin/mc find $INSTANCE --name "$1*$2*")
if [ -z "$EPISODE" ]; then
    echo "Episode not found for $1"
else
    echo "Found an episode for $1 - $2"
fi

# Now I need to share the file now that we've got the path for it
URL=$(/usr/bin/mc share download "$EPISODE" | grep -E "Share:" | sed 's/Share: //g')

# Lastly, launch MPV!
/usr/bin/mpv "$URL"